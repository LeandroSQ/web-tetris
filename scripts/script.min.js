!function n(i,a,o){function l(t,e){if(!a[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(s)return s(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=a[t]={exports:{}},i[t][0].call(r.exports,function(e){return l(i[t][1][e]||e)},r,r.exports,n,i,a,o)}return a[t].exports}for(var s="function"==typeof require&&require,e=0;e<o.length;e++)l(o[e]);return l}({1:[function(e,t,r){t.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],2:[function(e,t,r){function s(e,t,r,n,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,i)}t.exports=function(l){return function(){var e=this,o=arguments;return new Promise(function(t,r){var n=l.apply(e,o);function i(e){s(n,t,r,i,a,"next",e)}function a(e){s(n,t,r,i,a,"throw",e)}i(void 0)})}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],3:[function(e,t,r){t.exports=function(e,t){return t.get?t.get.call(e):t.value},t.exports.__esModule=!0,t.exports.default=t.exports},{}],4:[function(e,t,r){t.exports=function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],5:[function(e,t,r){t.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],6:[function(e,t,r){t.exports=function(e,t,r){if(t.has(e))return t.get(e);throw new TypeError("attempted to "+r+" private field on non-instance")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],7:[function(e,t,r){var n=e("./classApplyDescriptorGet.js"),i=e("./classExtractFieldDescriptor.js");t.exports=function(e,t){return t=i(e,t,"get"),n(e,t)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./classApplyDescriptorGet.js":3,"./classExtractFieldDescriptor.js":6}],8:[function(e,t,r){var n=e("./classApplyDescriptorSet.js"),i=e("./classExtractFieldDescriptor.js");t.exports=function(e,t,r){return t=i(e,t,"set"),n(e,t,r),r},t.exports.__esModule=!0,t.exports.default=t.exports},{"./classApplyDescriptorSet.js":4,"./classExtractFieldDescriptor.js":6}],9:[function(e,t,r){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}t.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],10:[function(e,t,r){t.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],11:[function(e,t,r){var i=e("./superPropBase.js");function n(){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=n=Reflect.get.bind():t.exports=n=function(e,t,r){var n=i(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:r):n.value},t.exports.__esModule=!0,t.exports.default=t.exports,n.apply(this,arguments)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{"./superPropBase.js":18}],12:[function(e,t,r){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],13:[function(e,t,r){var n=e("./setPrototypeOf.js");t.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./setPrototypeOf.js":17}],14:[function(e,t,r){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],15:[function(e,t,r){var n=e("./typeof.js").default,i=e("./assertThisInitialized.js");t.exports=function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./assertThisInitialized.js":1,"./typeof.js":19}],16:[function(e,P,t){var R=e("./typeof.js").default;function r(){"use strict";P.exports=function(){return o},P.exports.__esModule=!0,P.exports.default=P.exports;var o={},e=Object.prototype,s=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function a(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i,a,o,l,t=t&&t.prototype instanceof h?t:h,t=Object.create(t.prototype),n=new w(n||[]);return t._invoke=(i=e,a=r,o=n,l="suspendedStart",function(e,t){if("executing"===l)throw new Error("Generator is already running");if("completed"===l){if("throw"===e)throw t;return x()}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){r=function e(t,r){var n=t.iterator[r.method];if(void 0===n){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method))return c;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}n=u(n,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,c;n=n.arg;return n?n.done?(r[t.resultName]=n.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,c):n:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,c)}(r,o);if(r){if(r===c)continue;return r}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===l)throw l="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);l="executing";r=u(i,a,o);if("normal"===r.type){if(l=o.done?"completed":"suspendedYield",r.arg===c)continue;return{value:r.arg,done:o.done}}"throw"===r.type&&(l="completed",o.method="throw",o.arg=r.arg)}}),t}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}o.wrap=l;var c={};function h(){}function f(){}function p(){}var t={},d=(a(t,n,function(){return this}),Object.getPrototypeOf),d=d&&d(d(C([]))),b=(d&&d!==e&&s.call(d,n)&&(t=d),p.prototype=h.prototype=Object.create(t));function m(e){["next","throw","return"].forEach(function(t){a(e,t,function(e){return this._invoke(t,e)})})}function y(o,l){var t;this._invoke=function(r,n){function e(){return new l(function(e,t){!function t(e,r,n,i){var a,e=u(o[e],o,r);if("throw"!==e.type)return(r=(a=e.arg).value)&&"object"==R(r)&&s.call(r,"__await")?l.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):l.resolve(r).then(function(e){a.value=e,n(a)},function(e){return t("throw",e,n,i)});i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}}function v(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function g(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(v,this),this.reset(!0)}function C(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(s.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:x}}function x(){return{value:void 0,done:!0}}return a(b,"constructor",f.prototype=p),a(p,"constructor",f),f.displayName=a(p,i,"GeneratorFunction"),o.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,a(e,i,"GeneratorFunction")),e.prototype=Object.create(b),e},o.awrap=function(e){return{__await:e}},m(y.prototype),a(y.prototype,r,function(){return this}),o.AsyncIterator=y,o.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var a=new y(l(e,t,r,n),i);return o.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},m(b),a(b,i,"Generator"),a(b,n,function(){return this}),a(b,"toString",function(){return"[object Generator]"}),o.keys=function(r){var e,n=[];for(e in r)n.push(e);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},o.values=C,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(g),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return a.type="throw",a.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],a=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var o=s.call(i,"catchLoc"),l=s.call(i,"finallyLoc");if(o&&l){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var a=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,c):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),g(r),c}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,g(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},o}P.exports=r,P.exports.__esModule=!0,P.exports.default=P.exports},{"./typeof.js":19}],17:[function(e,r,t){function n(e,t){return r.exports=n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r.exports.__esModule=!0,r.exports.default=r.exports,n(e,t)}r.exports=n,r.exports.__esModule=!0,r.exports.default=r.exports},{}],18:[function(e,t,r){var n=e("./getPrototypeOf.js");t.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./getPrototypeOf.js":12}],19:[function(e,t,r){function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],20:[function(t,e,r){t=t("../helpers/regeneratorRuntime")();e.exports=t;try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},{"../helpers/regeneratorRuntime":16}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.UI_PANEL_BACKGROUND=r.TARGET_FRAME_TIME=r.TARGET_FPS=r.PIECE_MOVING_SPEED=r.PIECE_FALLING_SPEED=r.ONESHOT_BUTTON_TRIGGER_THRESHOLD=r.GRID_ROWS=r.GRID_PADDING=r.GRID_COLS=r.EMPTY_CELL_BORDER=r.EMPTY_CELL_BACKGROUND=r.CELL_RADIUS=r.CELL_PADDING=void 0;r.GRID_COLS=10,r.GRID_ROWS=20,r.GRID_PADDING=20,r.TARGET_FPS=60,r.TARGET_FRAME_TIME=1e3/60,r.PIECE_FALLING_SPEED=.6,r.PIECE_MOVING_SPEED=12,r.CELL_RADIUS=8.75,r.CELL_PADDING=1.75,r.UI_PANEL_BACKGROUND="rgba(0, 0, 0, 0.40)",r.EMPTY_CELL_BACKGROUND="rgba(0, 0, 0, 0.15)",r.EMPTY_CELL_BORDER="rgba(0, 0, 0, 0.35)";r.ONESHOT_BUTTON_TRIGGER_THRESHOLD=75},{}],22:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.ParticleController=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),o=n(e("@babel/runtime/helpers/classPrivateFieldGet")),l=n(e("@babel/runtime/helpers/classPrivateFieldSet"));e("../particle/particle");function s(e,t){var r,n,i,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(o=function(e,t){var r;if(e)return"string"==typeof e?u(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t,r){var n=e;if(t.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object");t.set(e,r)}var h=new WeakMap,n=function(){function t(e){(0,i.default)(this,t),c(this,h,{writable:!0,value:[]}),this.game=e,(0,l.default)(this,h,[])}return(0,a.default)(t,[{key:"update",value:function(e){for(var t=(0,o.default)(this,h).length-1;0<=t;t--){var r=(0,o.default)(this,h)[t];r.update(e),r.isAlive||(0,o.default)(this,h).splice(t,1)}}},{key:"render",value:function(e){var t,r=s((0,o.default)(this,h));try{for(r.s();!(t=r.n()).done;)t.value.render(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"reset",value:function(){(0,l.default)(this,h,[])}},{key:"add",value:function(e){return(0,o.default)(this,h).push(e),this}}]),t}();r.ParticleController=n},{"../particle/particle":46,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/classPrivateFieldGet":7,"@babel/runtime/helpers/classPrivateFieldSet":8,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GameStateType=void 0;r.GameStateType={MENU:"menu",PLAYING:"playing",GAMEOVER:"gameover",PAUSED:"paused"}},{}],24:[function(e,t,r){"use strict";var n,i=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.GamepadKeyToKeyboardKey=r.GamepadKey=void 0,i(e("@babel/runtime/helpers/defineProperty"))),e=e("./key"),a={A:0,B:1,X:2,Y:3,UP_PAD:12,DOWN_PAD:13,LEFT_PAD:14,RIGHT_PAD:15,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,MENU:9},i=(r.GamepadKey=a,(0,i.default)(n={},a.A,e.Key.ARROW_UP),(0,i.default)(n,a.DOWN_PAD,e.Key.ARROW_DOWN),(0,i.default)(n,a.LEFT_PAD,e.Key.ARROW_LEFT),(0,i.default)(n,a.RIGHT_PAD,e.Key.ARROW_RIGHT),(0,i.default)(n,a.B,e.Key.SPACE),(0,i.default)(n,a.X,e.Key.ENTER),(0,i.default)(n,a.MENU,e.Key.ESCAPE),(0,i.default)(n,a.LEFT_TRIGGER,e.Key.SHIFT),(0,i.default)(n,a.RIGHT_TRIGGER,e.Key.SHIFT),(0,i.default)(n,a.Y,e.Key.CONTROL),n);r.GamepadKeyToKeyboardKey=i},{"./key":25,"@babel/runtime/helpers/defineProperty":10,"@babel/runtime/helpers/interopRequireDefault":14}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Key=void 0;r.Key={ARROW_UP:"ArrowUp",ENTER:"Enter",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",SPACE:"Space",ESCAPE:"Escape",SHIFT:"Shift",CONTROL:"KeyM"}},{}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Setting=void 0;r.Setting={MUSIC_ENABLED:"music",SOUND_EFFECTS_ENABLED:"soundFX",FALL_PARTICLES_ENABLED:"fallParticles",COMBO_PARTICLES_ENABLED:"comboParticles"}},{}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SoundEffect=void 0;r.SoundEffect={PLACE_BLOCK:"place.mp3",GAME_OVER:"gameover.wav",THEME:"music.mp3",SCORE:"score.wav",START_GAME:"doot doot.mp3"}},{}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TetrominoType=void 0;r.TetrominoType={L:0,J:1,I:2,O:3,S:4,Z:5,T:6}},{}],29:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault")(e("@babel/runtime/helpers/defineProperty")),o=e("./constants");function i(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach(function(e){(0,n.default)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}window.addLoadEventListener=function(e){function t(){n||(n=!0,e())}var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3,n=!1;window.addEventListener("DOMContentLoaded",t),window.addEventListener("load",t),document.addEventListener("load",t),window.addEventListener("ready",t),setTimeout(t,r)},window.addVisibilityChangeEventListener=function(e){function t(){r||(r=!0,e(!document.hidden))}var r=!1;["visibilitychange","webkitvisibilitychange","mozvisibilitychange","msvisibilitychange"].forEach(function(e){window.addEventListener(e,t)})},Math.clamp=function(e,t,r){return r<e?r:e<t?t:e},Math.lerp=function(e,t,r){t-=e;return r<t?e+r:t<-r?e-r:e+t},Math.randomRange=function(e,t){return Math.random()*(t-e)+e},Math.randomIntRange=function(e,t){return Math.floor(Math.randomRange(e,t))},Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},Array.prototype.transpose=function(){for(var e=this.slice(0),t=e.length,r=e[0].length,n=[],i=0;i<r;i++)n[i]=Array(t);for(var a=0;a<t;a++)for(var o=0;o<r;o++)n[o][a]=e[a][o];return n},Array.prototype.reverseColumns=function(){for(var e=0;e<this.length;e++)this[e]=this[e].reverse();return this},Array.prototype.reverseRows=function(){return this.reverse()},CanvasRenderingContext2D.prototype.fillTextCentered=function(e,t,r){var n=this.measureText(e);this.fillText(e,t-n.width/2,r)},window.fillShape=!0,window.drawShape="roundRect",CanvasRenderingContext2D.prototype.drawShape=function(t,r,n,i){var a=this;({roundRect:function(){return a.roundRect(t,r,n,i,[o.CELL_RADIUS])},rect:function(){return a.rect(t,r,n,i)},circle:function(){var e=(n+i)/4;a.arc(t+e,r+e,e,0,2*Math.PI)},triangle:function(){a.moveTo(t,r),a.lineTo(t+n,r),a.lineTo(t+n/2,r+i),a.lineTo(t,r)},hexagon:function(){a.moveTo(t,r+i/2),a.lineTo(t+n/4,r+i),a.lineTo(t+n-n/4,r+i),a.lineTo(t+n,r+i/2),a.lineTo(t+n-n/4,r),a.lineTo(t+n/4,r),a.lineTo(t,r+i/2)}})[window.drawShape]()},CanvasRenderingContext2D.prototype.fillShape=function(e,t,r,n){this.drawShape(e,t,r,n),this.fill()},CanvasRenderingContext2D.prototype.hasOwnProperty("roundRect")||(CanvasRenderingContext2D.prototype.roundRect=function(e,t,r,n,i){i=Array.isArray(i)?i.length<=1?{tl:i[0],tr:i[0],br:i[0],bl:i[0]}:{tl:i[0]||0,tr:i[1]||0,br:i[2]||0,bl:i[3]||0}:"number"==typeof i?{tl:i,tr:i,br:i,bl:i}:a(a({},{tl:0,tr:0,br:0,bl:0}),i);this.beginPath(),this.moveTo(e+i.tl,t),this.lineTo(e+r-i.tr,t),this.quadraticCurveTo(e+r,t,e+r,t+i.tr),this.lineTo(e+r,t+n-i.br),this.quadraticCurveTo(e+r,t+n,e+r-i.br,t+n),this.lineTo(e+i.bl,t+n),this.quadraticCurveTo(e,t+n,e,t+n-i.bl),this.lineTo(e,t+i.tl),this.quadraticCurveTo(e,t,e+i.tl,t),this.closePath()}),CanvasRenderingContext2D.prototype.fillRoundRect=function(e,t,r,n,i){this.roundRect(e,t,r,n,i),this.fill()},Array.prototype.shuffle=function(){for(var e=this.length-1;0<e;e--){var t=Math.floor(Math.random()*(e+1)),r=[this[t],this[e]];this[e]=r[0],this[t]=r[1]}return this},ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){for(var r=new Uint8Array(this),t=(null==t&&(t=r.length),new ArrayBuffer(t-e)),n=new Uint8Array(t),i=0;i<n.length;i++)n[i]=r[i+e];return t}),Array.prototype.clear||(Array.prototype.clear=function(){this.splice(0,this.length)})},{"./constants":21,"@babel/runtime/helpers/defineProperty":10,"@babel/runtime/helpers/interopRequireDefault":14}],30:[function(e,t,r){"use strict";e("./level0"),e("./level1"),e("./level2"),e("./level3"),e("./level4")},{"./level0":31,"./level1":32,"./level2":33,"./level3":34,"./level4":35}],31:[function(e,t,r){"use strict";var e=e("../model/level"),n=new e.Level({speed:1,shape:"roundRect",fillShape:!0,pieces:{background:["#01BAEF","#0466c8","#f8961e","#ffd166","#2CDA9D","#ef476f","#f15bb5"],border:["#0193bc","#034c96","#dc7c07","#ffb300","#1fb480","#eb184a","#d41287"]},page:{background:"#073B4C",foreground:"#ecf0f1"}});e.Level.list.push(n)},{"../model/level":41}],32:[function(e,t,r){"use strict";var e=e("../model/level"),n=new e.Level({speed:1.75,shape:"rect",fillShape:!0,pieces:{background:["#01BAEF","#0466c8","#f8961e","#ffd166","#2CDA9D","#ef476f","#f15bb5"],border:["#0193bc","#034c96","#dc7c07","#ffb300","#1fb480","#eb184a","#d41287"]},page:{background:"#073B4C",foreground:"#ecf0f1"}});e.Level.list.push(n)},{"../model/level":41}],33:[function(e,t,r){"use strict";var e=e("../model/level"),n=new e.Level({speed:2.5,shape:"rect",fillShape:!1,pieces:{background:["#8be9fd","#6272a4","#ffb86c","#f1fa8c","#50fa7b","#ff5555","#ff79c6"],border:["#59e0fc","#4d5b86","#ff9f39","#ebf85b","#1ef956","#ff2222","#ff46b0"]},page:{background:"#282a36",foreground:"#f8f8f2"}});e.Level.list.push(n)},{"../model/level":41}],34:[function(e,t,r){"use strict";var e=e("../model/level"),n=new e.Level({speed:3.75,shape:"circle",fillShape:!0,pieces:{background:["#a1efe4","#65d9ef","#fd971e","#e6db74","#a7e22d","#f92572","#fd5fef"],border:["#75e8d7","#37ceea","#e67e02","#ded049","#8bc11b","#e50657","#fc2cea"]},page:{background:"#272822",foreground:"#f8f8f2"}});e.Level.list.push(n)},{"../model/level":41}],35:[function(e,t,r){"use strict";var e=e("../model/level"),n=new e.Level({speed:5.75,shape:"hexagon",fillShape:!0,pieces:{background:["#03a9f4","#304ffe","#fb8c00","#ffeb3b","#4caf50","#f44336","#ec407a"],border:["#0286c1","#0127fa","#c87000","#ffe608","#3d8b40","#ea1c0d","#e2175b"]},page:{background:"#263238",foreground:"#fafafa"}});e.Level.list.push(n)},{"../model/level":41}],36:[function(e,G,t){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault"),n=(Object.defineProperty(t,"__esModule",{value:!0}),t.Main=void 0,r(e("@babel/runtime/regenerator"))),i=r(e("@babel/runtime/helpers/asyncToGenerator")),a=r(e("@babel/runtime/helpers/classCallCheck")),o=r(e("@babel/runtime/helpers/createClass")),l=(e("./extensions"),e("./level"),e("./widget/density-canvas")),s=e("./constants"),u=e("./enum/game-state-type"),c=e("./model/board"),h=e("./model/level"),f=e("./controller/particle-controller"),p=e("./state/game-state-menu"),d=(e("./state/game-state"),e("./state/game-state-playing")),b=e("./util/input"),m=(e("./util/mouse"),e("./state/game-state-over")),y=e("./model/cell"),v=e("./state/game-state-pause"),g=e("./ui/ui-stats"),U=(e("./ui/ui-panel"),e("./ui/ui-bag")),j=e("./util/locale");function w(e,t){var r=e;if(t.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object");t.add(e)}function C(e,t,r){if(t.has(e))return r;throw new TypeError("attempted to get private field on non-instance")}var x=new WeakSet,P=new WeakSet,R=new WeakSet,S=new WeakSet,E=new WeakSet,k=new WeakSet,T=new WeakSet,_=new WeakSet,O=new WeakSet,D=new WeakSet,r=function(){function e(){(0,a.default)(this,e),w(this,D),w(this,O),w(this,_),w(this,T),w(this,k),w(this,E),w(this,S),w(this,R),w(this,P),w(this,x),this.canvas=new l.DensityCanvas,this.ctx=this.canvas.context,this.currentLevelIndex=0,this.startFrameTime=0,this.lastFrameTime=0,this.frameCounter=0,this.fpsTimer=0,this.fps=0,this.board=new c.Board,this.particleController=new f.ParticleController(this),C(this,x,N).call(this),C(this,P,B).call(this),C(this,R,z).call(this)}return(0,o.default)(e,[{key:"reset",value:function(){this.currentLevelIndex=0,this.board.fill(y.Cell.empty)}},{key:"currentLevel",get:function(){return h.Level.list[this.currentLevelIndex]}},{key:"currentGameState",get:function(){switch(this.state){case u.GameStateType.MENU:return this.stateMenu;case u.GameStateType.PLAYING:return this.statePlaying;case u.GameStateType.GAMEOVER:return this.stateOver;case u.GameStateType.PAUSED:return this.statePaused;default:return null}}},{key:"uiPanels",get:function(){return Object.values(this.ui)}}]),e}();function N(){this.state=u.GameStateType.MENU,this.stateOver=new m.GameStateOver(this),this.stateMenu=new p.GameStateMenu(this),this.statePaused=new v.GameStatePause(this),this.statePlaying=new d.GameStatePlaying(this)}function B(){this.ui={score:new g.UIStats(this),bag:new U.UIBag(this)}}function z(){window.addLoadEventListener(C(this,S,F).bind(this)),window.addEventListener("resize",C(this,E,L).bind(this)),window.addVisibilityChangeEventListener(C(this,k,K).bind(this))}function F(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)(n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.LocaleUtils.initialize();case 2:this.canvas.attachToElement(document.querySelector("#wrapper")),C(this,E,L).call(this),this.lastFrameTime=performance.now(),C(this,D,M).call(this);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function L(){this.board.setSize({width:window.innerWidth-2*s.GRID_PADDING,height:window.innerHeight-2*s.GRID_PADDING});var t={width:this.board.width,height:this.board.height},r=0;this.uiPanels.forEach(function(e){e.calculateSize(t);e=e.size.width+e.padding;r<e&&(r=e)}),t.width+=r,this.canvas.setSize(t)}function K(e){e||this.currentGameState!=u.GameStateType.PLAYING||(this.currentGameState=u.GameStateType.PAUSED,this.lastFrameTime=performance.now())}function I(){this.startFrameTime=performance.now();var e=(this.startFrameTime-this.lastFrameTime)/1e3;this.frameCounter++,this.fpsTimer+=e,1<this.fpsTimer&&(--this.fpsTimer,this.fps=this.frameCounter,this.frameCounter=0),C(this,_,q).call(this,e),C(this,D,M).call(this)}function q(e){this.canvas.clear(),b.InputUtils.update();var t=this.currentGameState;null!=t&&t.update(e),null!=t&&t.render(this.ctx,e),C(this,O,W).call(this)}function W(){this.ctx.fillStyle="white",this.ctx.fillText("".concat(this.fps," FPS"),10,20)}function M(){var e;window.hasOwnProperty("requestAnimationFrame")?requestAnimationFrame(C(this,T,I).bind(this)):(e=this.startFrameTime-performance.now(),e=Math.clamp(s.TARGET_FRAME_TIME-e,0,s.TARGET_FRAME_TIME),setTimeout(C(this,T,I).bind(this),e)),this.lastFrameTime=performance.now()}t.Main=r,window.main=new r},{"./constants":21,"./controller/particle-controller":22,"./enum/game-state-type":23,"./extensions":29,"./level":30,"./model/board":37,"./model/cell":38,"./model/level":41,"./state/game-state":51,"./state/game-state-menu":47,"./state/game-state-over":48,"./state/game-state-pause":49,"./state/game-state-playing":50,"./ui/ui-bag":52,"./ui/ui-panel":53,"./ui/ui-stats":54,"./util/input":58,"./util/locale":59,"./util/mouse":60,"./widget/density-canvas":64,"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/regenerator":20}],37:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.Board=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),o=e("../constants"),l=e("./cell"),s=e("../widget/density-canvas"),u=e("./piece");function c(e,t){var r=e;if(t.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object");t.add(e)}var h=new WeakSet,n=function(){function e(){(0,i.default)(this,e),c(this,h),this.rows=o.GRID_ROWS,this.columns=o.GRID_COLS,this.grid=[],this.fill(l.Cell.empty),this.width=0,this.height=0,this.cellSize=0,this.isBufferDirty=!0,this.buffer=new s.DensityCanvas}return(0,a.default)(e,[{key:"fill",value:function(e){this.grid=[];for(var t=0;t<this.rows;t++){for(var r=[],n=0;n<this.columns;n++)r.push(e);this.grid.push(r)}}},{key:"setSize",value:function(e){var t=e.width,e=e.height;this.cellSize=Math.floor(Math.min(t/this.columns,e/this.rows)),window.fontScale=this.cellSize/41,this.width=this.cellSize*this.columns,this.height=this.cellSize*this.rows,this.buffer.setSize({width:this.width,height:this.height})}},{key:"render",value:function(e){this.isBufferDirty&&!function(e,t,r){if(t.has(e))return r;throw new TypeError("attempted to get private field on non-instance")}(this,h,f).call(this),this.buffer.drawBufferTo(0,0,e)}},{key:"invalidate",value:function(){this.isBufferDirty=!0}},{key:"place",value:function(e){for(var t=0;t<e.height;t++)for(var r,n,i=0;i<e.width;i++)e.shape[t][i]!==u.Piece.empty&&(r=i+e.x,n=t+e.y,this.grid[n][r]=new l.Cell(e.color))}},{key:"isAnyCellBellowShape",value:function(e){return this.checkShapeCollision(e,1,0)}},{key:"checkShapeCollision",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=0;n<e.height;n++)for(var i=0;i<e.width;i++)if(e.shape[n][i]!==u.Piece.empty){var a=i+e.x+r,o=n+e.y+t;if(!(o<0||a<0||a>=this.columns||o>=this.rows||this.isCellEmpty(o,a)))return!0}return!1}},{key:"isCellEmpty",value:function(e,t){return this.grid[e][t]===l.Cell.empty}},{key:"removeFilledRows",value:function(){for(var e=0,t=0;t<this.rows;t++){for(var r=!0,n=0;n<this.columns;n++)if(this.isCellEmpty(t,n)){r=!1;break}if(r){e++;for(var i=[],a=0;a<this.columns;a++)i.push(l.Cell.empty);this.grid.splice(t,1),this.grid.unshift(i)}}return e}},{key:"setColorForAllCells",value:function(e,t){for(var r=0;r<this.rows;r++)for(var n=0;n<this.columns;n++)this.isCellEmpty(r,n)||this.grid[r][n].setColor(e,t)}},{key:"rowsWithAtLeastOneCell",get:function(){for(var e=0,t=0;t<this.rows;t++)for(var r=0;r<this.columns;r++)if(!this.isCellEmpty(t,r)){e++;break}return e}}]),e}();function f(){this.buffer.clear(),this.buffer.context.fillStyle="rgba(0, 0, 0, 0.35)",this.buffer.context.fillRoundRect(0,0,this.width,this.height,[o.CELL_RADIUS]);for(var e=0;e<this.rows;e++)for(var t=0;t<this.columns;t++){var r=this.grid[e][t];l.Cell.render(this.buffer.context,r,t,e,this.cellSize)}}r.Board=n},{"../constants":21,"../widget/density-canvas":64,"./cell":38,"./piece":42,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],38:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.Cell=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),o=e("../constants");r.Cell=function(){function t(e){(0,i.default)(this,t),this.color=e}return(0,a.default)(t,[{key:"setColor",value:function(e,t){this.color.background=e,this.color.border=t}}],[{key:"render",value:function(e,t,r,n,i){t?(e.fillStyle=t.color.background,e.strokeStyle=t.color.border):(e.fillStyle=o.EMPTY_CELL_BACKGROUND,e.strokeStyle=o.EMPTY_CELL_BORDER),e.lineWidth=window.fillShape?1:2,e.beginPath(),e.drawShape(r*i+o.CELL_PADDING,n*i+o.CELL_PADDING,i-2*o.CELL_PADDING,i-2*o.CELL_PADDING),window.fillShape&&e.fill(),e.stroke()}},{key:"empty",get:function(){return null}}]),t}()},{"../constants":21,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],39:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),a=(Object.defineProperty(r,"__esModule",{value:!0}),r.FallingPiece=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),o=n(e("@babel/runtime/helpers/createClass")),l=n(e("@babel/runtime/helpers/assertThisInitialized")),s=n(e("@babel/runtime/helpers/inherits")),i=n(e("@babel/runtime/helpers/possibleConstructorReturn")),u=n(e("@babel/runtime/helpers/getPrototypeOf")),n=e("./piece"),c=(e("./tetromino"),e("../main"),e("../util/input")),h=e("../enum/key"),f=e("../constants");function p(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,u.default)(r);return e=n?(e=(0,u.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,i.default)(this,e)}}function d(e,t){var r=e;if(t.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object");t.add(e)}function b(e,t,r){if(t.has(e))return r;throw new TypeError("attempted to get private field on non-instance")}var m=new WeakSet,y=new WeakSet,e=function(e){(0,s.default)(i,e);var n=p(i);function i(e,t){var r;return(0,a.default)(this,i),r=n.call(this),d((0,l.default)(r),y),d((0,l.default)(r),m),r.game=e,r.type=t.type,r.shape=t.shape,r.position={x:e.board.columns/2-r.width/2,y:-1},r.drawPosition={x:r.position.x,y:r.position.y},r}return(0,o.default)(i,[{key:"update",value:function(e){var t=f.PIECE_MOVING_SPEED*e;this.drawPosition.x=Math.lerp(this.drawPosition.x,Math.floor(this.position.x),t),this.drawPosition.y=Math.lerp(this.drawPosition.y,Math.ceil(this.position.y),2*t),b(this,m,v).call(this,e),this.move({x:0,y:f.PIECE_FALLING_SPEED*e*this.game.currentLevel.speed})}},{key:"move",value:function(e){var t=e.x,t=void 0===t?0:t,e=e.y,e=void 0===e?0:e,r=this.game.board;return this.position.x+=t,this.position.y+=e,r.checkShapeCollision(this)?(this.position.x-=t,this.position.y-=e,!1):(t=!1,this.x<0?t=!(this.position.x=0):this.x+this.width>r.columns&&(this.position.x=r.columns-this.width,t=!0),this.y<0?t=!(this.position.y=0):this.y+this.height>r.rows&&(this.position.y=r.rows-this.height,t=!0),!t)}},{key:"rotate",value:function(e){this.shape=e?this.shape.transpose().reverseRows():this.shape.reverseRows().transpose()}},{key:"color",get:function(){return this.game.currentLevel.getColorForPiece(this.type)}},{key:"width",get:function(){return this.shape[0].length}},{key:"height",get:function(){return this.shape.length}},{key:"x",get:function(){return Math.floor(this.position.x)}},{key:"y",get:function(){return Math.floor(this.drawPosition.y)}}]),i}(n.Piece);function v(e){c.InputUtils.isKeyDown(h.Key.ARROW_UP)?this.rotate(!0):c.InputUtils.isKeyDown(h.Key.ENTER)&&this.rotate(!1);var t=c.InputUtils.isKeyDown(h.Key.SHIFT)?1.5:1;c.InputUtils.isKeyDownOneshot(h.Key.ARROW_LEFT)?(this.position.x=Math.ceil(this.drawPosition.x)-1,this.move({x:0,y:0}),this.drawPosition.x=this.position.x):c.InputUtils.isKeyDown(h.Key.ARROW_LEFT)&&this.move({x:-f.PIECE_MOVING_SPEED*e*t,y:0}),c.InputUtils.isKeyDownOneshot(h.Key.ARROW_RIGHT)?(this.position.x=Math.floor(this.drawPosition.x)+1,this.move({x:0,y:0}),this.drawPosition.x=this.position.x):c.InputUtils.isKeyDown(h.Key.ARROW_RIGHT)&&this.move({x:f.PIECE_MOVING_SPEED*e*t,y:0}),c.InputUtils.isKeyDown(h.Key.ARROW_DOWN)?this.move({x:0,y:f.PIECE_MOVING_SPEED*e*2*t}):c.InputUtils.isKeyDown(h.Key.SPACE)&&b(this,y,g).call(this)}function g(){for(var e=Math.ceil(this.game.board.rows-this.height-this.position.y),t=(this.position.y=Math.ceil(this.position.y),this.drawPosition.y=this.position.y,0),r=0;r<e&&!this.game.board.checkShapeCollision(this,++t)&&!(this.position.y+t+this.height>this.game.board.rows);r++);this.position.y+=--t,this.drawPosition.y=this.position.y}r.FallingPiece=e},{"../constants":21,"../enum/key":25,"../main":36,"../util/input":58,"./piece":42,"./tetromino":43,"@babel/runtime/helpers/assertThisInitialized":1,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/getPrototypeOf":12,"@babel/runtime/helpers/inherits":13,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/helpers/possibleConstructorReturn":15}],40:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.GhostPiece=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),o=n(e("@babel/runtime/helpers/assertThisInitialized")),l=n(e("@babel/runtime/helpers/inherits")),s=n(e("@babel/runtime/helpers/possibleConstructorReturn")),u=n(e("@babel/runtime/helpers/getPrototypeOf")),n=e("./piece"),c=(e("./falling-piece"),e("../constants"),e("../util/color"));function h(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,u.default)(r);return e=n?(e=(0,u.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,s.default)(this,e)}}function f(e,t){var r=e;if(t.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object");t.add(e)}function p(e,t,r){if(t.has(e))return r;throw new TypeError("attempted to get private field on non-instance")}var d=new WeakSet,e=function(e){(0,l.default)(n,e);var r=h(n);function n(e){var t;return(0,i.default)(this,n),t=r.call(this),f((0,o.default)(t),d),t.owner=e,t.game=e.game,t.lastShapeLength=p((0,o.default)(t),d,b).call((0,o.default)(t)),t.drawPosition={x:0,y:e.y},t.calculateColor(),t}return(0,a.default)(n,[{key:"calculateColor",value:function(){var e=c.ColorUtils.blend(.35,this.game.currentLevel.page.background,"#000"),e=c.ColorUtils.blend(.15,e,"#000");this.color={background:c.ColorUtils.blend(1-.34,this.owner.color.background,e),border:c.ColorUtils.blend(1-.34,this.owner.color.border,e)}}},{key:"update",value:function(e){var t=!1;if(this.x===this.owner.x&&this.lastShapeLength==p(this,d,b).call(this)||(t=!0,this.lastShapeLength=p(this,d,b).call(this)),this.drawPosition.x=this.owner.x,t)for(this.drawPosition.y=this.owner.y;this.y+this.height<this.game.board.rows&&!this.game.board.checkShapeCollision(this,1,0);)this.drawPosition.y=Math.ceil(this.drawPosition.y+1)}},{key:"x",get:function(){return Math.floor(this.drawPosition.x)}},{key:"y",get:function(){return Math.ceil(this.drawPosition.y)}},{key:"shape",get:function(){return this.owner.shape}},{key:"width",get:function(){return this.owner.width}},{key:"height",get:function(){return this.owner.height}}]),n}(n.Piece);function b(){return"".concat(this.owner.shape.length,"x").concat(this.owner.shape[0].length)}r.GhostPiece=e},{"../constants":21,"../util/color":56,"./falling-piece":39,"./piece":42,"@babel/runtime/helpers/assertThisInitialized":1,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/getPrototypeOf":12,"@babel/runtime/helpers/inherits":13,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/helpers/possibleConstructorReturn":15}],41:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=(Object.defineProperty(r,"__esModule",{value:!0}),r.Level=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),i=n(e("@babel/runtime/helpers/createClass")),n=n(e("@babel/runtime/helpers/defineProperty")),e=function(){function a(e){var t=e.speed,r=e.pieces,n=e.page,i=e.shape,e=e.fillShape;(0,o.default)(this,a),this.speed=t,this.page=n,this.pieces=r,this.shape=i,this.fillShape=e}return(0,i.default)(a,[{key:"applyPageColors",value:function(){var e=document.documentElement;e.style.setProperty("--background",this.page.background),e.style.setProperty("--foreground",this.page.foreground),window.fillShape=this.fillShape,window.drawShape=this.shape}},{key:"getColorForPiece",value:function(e){return{background:this.pieces.background[e%this.pieces.background.length],border:this.pieces.border[e%this.pieces.border.length]}}}]),a}();r.Level=e,(0,n.default)(e,"list",[])},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/defineProperty":10,"@babel/runtime/helpers/interopRequireDefault":14}],42:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.Piece=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),l=e("../constants");r.Piece=function(){function o(){(0,i.default)(this,o)}return(0,a.default)(o,[{key:"render",value:function(e,t){e.fillStyle=this.color.background,e.strokeStyle=this.color.border,e.lineWidth=1.5;for(var r=0;r<this.shape.length;r++)for(var n,i,a=0;a<this.shape[r].length;a++)this.shape[r][a]!==o.empty&&(n=a*t,i=r*t,e.beginPath(),e.drawShape(this.drawPosition.x*t+n+l.CELL_PADDING,this.drawPosition.y*t+i+l.CELL_PADDING,t-2*l.CELL_PADDING,t-2*l.CELL_PADDING),e.closePath(),window.fillShape&&e.fill(),e.stroke())}},{key:"cellCount",get:function(){for(var e=0,t=0;t<this.shape.length;t++)for(var r=0;r<this.shape[t].length;r++)this.shape[t][r]!==o.empty&&e++;return e}}],[{key:"empty",get:function(){return 0}}]),o}()},{"../constants":21,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],43:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.Tetrominoes=r.Tetromino=void 0,n(e("@babel/runtime/helpers/createClass"))),a=n(e("@babel/runtime/helpers/classCallCheck")),n=e("../enum/tetromino-type"),e=(0,i.default)(function e(t,r){(0,a.default)(this,e),this.shape=t,this.type=r}),i=[new(r.Tetromino=e)([[1,1,1,1]],n.TetrominoType.I),new e([[1,0,0],[1,1,1]],n.TetrominoType.J),new e([[0,0,1],[1,1,1]],n.TetrominoType.L),new e([[1,1],[1,1]],n.TetrominoType.O),new e([[0,1,1],[1,1,0]],n.TetrominoType.S),new e([[1,1,0],[0,1,1]],n.TetrominoType.Z),new e([[0,1,0],[1,1,1]],n.TetrominoType.T)];r.Tetrominoes=i},{"../enum/tetromino-type":28,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],44:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),l=(Object.defineProperty(r,"__esModule",{value:!0}),r.ComboParticle=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),i=n(e("@babel/runtime/helpers/createClass")),s=n(e("@babel/runtime/helpers/assertThisInitialized")),u=n(e("@babel/runtime/helpers/get")),c=n(e("@babel/runtime/helpers/inherits")),a=n(e("@babel/runtime/helpers/possibleConstructorReturn")),h=n(e("@babel/runtime/helpers/getPrototypeOf")),f=e("../util/locale"),n=e("./particle");function p(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,h.default)(r);return e=n?(e=(0,h.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,a.default)(this,e)}}function d(e,t){var r=e;if(t.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object");t.add(e)}function b(e,t,r){if(t.has(e))return r;throw new TypeError("attempted to get private field on non-instance")}var m=new WeakSet,y=new WeakSet,e=function(e){(0,c.default)(o,e);var a=p(o);function o(e){var t,r=e.x,n=e.y,i=e.multiplier,e=e.game;return(0,l.default)(this,o),t=a.call(this),d((0,s.default)(t),y),d((0,s.default)(t),m),t.x=r,t.y=n,t.text="COMBO ".concat(i,"x"),b((0,s.default)(t),m,v).call((0,s.default)(t),e),t.size=1,t}return(0,i.default)(o,[{key:"update",value:function(e){(0,u.default)((0,h.default)(o.prototype),"update",this).call(this,e),this.size+=.15*e*60,this.y-=.45*e*60}},{key:"render",value:function(e){e.fillStyle="#fefefe".concat(parseInt(this.alpha).toString(16)),b(this,y,g).call(this,e),e.fillTextCentered(f.LocaleUtils.get("combo"),this.x,this.y)}},{key:"alpha",get:function(){return 255*(1-Math.min(this.timeAlive,this.timeToLive)/this.timeToLive)}}]),o}(n.Particle);function v(e){b(this,y,g).call(this,e.ctx);var t=e.ctx.measureText(this.text),r=t.width,t=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent;this.x=Math.floor(Math.clamp(this.x,r/4,e.canvas.width-r/4)),this.y=Math.floor(Math.clamp(this.y,t/2,e.canvas.height-1.5*t))}function g(e){e.fontFamily="".concat(parseInt(8*this.size),"px Nintendoid1")}r.ComboParticle=e},{"../util/locale":59,"./particle":46,"@babel/runtime/helpers/assertThisInitialized":1,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/get":11,"@babel/runtime/helpers/getPrototypeOf":12,"@babel/runtime/helpers/inherits":13,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/helpers/possibleConstructorReturn":15}],45:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=(Object.defineProperty(r,"__esModule",{value:!0}),r.ExplosionParticle=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),i=n(e("@babel/runtime/helpers/createClass")),l=n(e("@babel/runtime/helpers/get")),u=n(e("@babel/runtime/helpers/inherits")),a=n(e("@babel/runtime/helpers/possibleConstructorReturn")),c=n(e("@babel/runtime/helpers/getPrototypeOf"));e("../controller/particle-controller"),e("../model/piece");function h(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,c.default)(r);return e=n?(e=(0,c.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,a.default)(this,e)}}n=function(e){(0,u.default)(s,e);var a=h(s);function s(e){var t,r=e.x,n=e.y,i=e.color,e=e.angle;return(0,o.default)(this,s),(t=a.call(this)).timeToLive=Math.randomRange(.083,.15),t.x=r,t.y=n,t.angle=e,t.speed=270*Math.random()+120,t.color=i,t}return(0,i.default)(s,[{key:"update",value:function(e){(0,l.default)((0,c.default)(s.prototype),"update",this).call(this,e),this.x+=Math.cos(this.angle)*e*this.speed,this.y+=Math.sin(this.angle)*e*this.speed}},{key:"render",value:function(e){e.fillStyle=this.color+this.alpha,e.fillRect(this.x,this.y,2*window.devicePixelRatio,2*window.devicePixelRatio)}},{key:"alpha",get:function(){return parseInt(255*(1-Math.min(this.timeAlive,this.timeToLive)/this.timeToLive)).toString(16).padStart(2,"0")}}],[{key:"create",value:function(e,t,r){for(var n={x:r.x*t,y:(r.y+r.height)*t},i=r.width*t,a=Math.randomIntRange(20,40),o=0;o<a;o++){var l=new s({x:n.x+(1-o/a)*i,y:n.y,color:r.color.background,angle:o/a*Math.PI});e.add(l)}}}]),s}(e("./particle").Particle);r.ExplosionParticle=n},{"../controller/particle-controller":22,"../model/piece":42,"./particle":46,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/get":11,"@babel/runtime/helpers/getPrototypeOf":12,"@babel/runtime/helpers/inherits":13,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/helpers/possibleConstructorReturn":15}],46:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.Particle=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass"));r.Particle=function(){function e(){(0,i.default)(this,e),this.isAlive=!0,this.timeAlive=0,this.timeToLive=Math.randomRange(.29,.337)}return(0,a.default)(e,[{key:"update",value:function(e){this.timeAlive>=this.timeToLive?(this.timeAlive=this.timeToLive,this.isAlive=!1):this.timeAlive+=e}},{key:"render",value:function(e){}}]),e}()},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],47:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.GameStateMenu=void 0,n(e("@babel/runtime/regenerator"))),a=n(e("@babel/runtime/helpers/asyncToGenerator")),o=n(e("@babel/runtime/helpers/classCallCheck")),l=n(e("@babel/runtime/helpers/createClass")),s=n(e("@babel/runtime/helpers/assertThisInitialized")),u=n(e("@babel/runtime/helpers/inherits")),c=n(e("@babel/runtime/helpers/possibleConstructorReturn")),h=n(e("@babel/runtime/helpers/getPrototypeOf")),f=e("../util/input"),p=(e("../main"),e("../util/audio")),d=e("../enum/sound-effect"),b=e("../constants"),m=e("../util/text"),n=e("./game-state"),y=e("./../enum/game-state-type"),v=e("../enum/setting"),g=e("../util/preference"),w=e("../util/locale");e("../util/image");function C(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,h.default)(r);return e=n?(e=(0,h.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,c.default)(this,e)}}function x(e,t){var r=e;if(t.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object");t.add(e)}function P(e,t,r){if(t.has(e))return r;throw new TypeError("attempted to get private field on non-instance")}var R=new WeakSet,S=new WeakSet,E=new WeakSet,e=function(e){(0,u.default)(n,e);var r=C(n);function n(e){var t;return(0,o.default)(this,n),t=r.call(this),x((0,s.default)(t),E),x((0,s.default)(t),S),x((0,s.default)(t),R),t.isTransitioning=!1,t.transitionTimer=0,t.progress=1,t.game=e,t.isThemePlaying=!1,t}return(0,l.default)(n,[{key:"update",value:function(e){this.isTransitioning?(this.transitionTimer+=e,.4<this.transitionTimer&&(this.transitionTimer=.4,this.game.state=y.GameStateType.PLAYING,this.game.statePlaying.reset(),f.InputUtils.resetAllKeys()),this.progress=Math.pow(1-this.transitionTimer/.4,2.5)):f.InputUtils.isAnyKeyDown()&&(P(this,R,k).call(this),this.isTransitioning=!0)}},{key:"render",value:function(e){e.fillStyle="rgba(0, 0, 0, ".concat(.35*this.progress,")"),e.save(),e.translate((this.game.canvas.width/2-this.game.board.width/2)*this.progress,0),e.beginPath(),e.fillRoundRect(0,0,this.game.board.width,this.game.board.height,[b.CELL_RADIUS]),this.game.board.render(e),m.TextUtils.drawCRT({ctx:e,text:w.LocaleUtils.get("tetris"),x:this.game.board.width/2,y:this.game.board.height/2-25,fontFamily:"Nintendoid1",fontSize:45*window.fontScale,color:"#fefefe"}),m.TextUtils.drawCRT({ctx:e,text:w.LocaleUtils.get("press_any_key_to_start"),x:this.game.board.width/2,y:this.game.board.height/2+10,fontFamily:"Nintendoid1",fontSize:8*window.fontScale,color:"#fefefe"}),e.restore()}}]),n}(n.GameState);function k(){return T.apply(this,arguments)}function T(){return(T=(0,a.default)(i.default.mark(function e(){var t=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(g.PreferenceUtils.getSetting(v.Setting.SOUND_EFFECTS_ENABLED))return e.next=3,p.AudioUtils.play({audio:d.SoundEffect.START_GAME,volume:.15,loop:!1,cache:!1,onStart:function(){P(t,S,_).call(t)},onEnd:function(){P(t,E,D).call(t)}});e.next=5;break;case 3:e.next=9;break;case 5:return e.next=7,P(this,S,_).call(this);case 7:return e.next=9,P(this,E,D).call(this);case 9:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function _(){return O.apply(this,arguments)}function O(){return(O=(0,a.default)(i.default.mark(function e(){var t,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=62.5,r=125,e.next=5,f.InputUtils.rumbleSequence([{force:1,duration:r,delay:0},{force:.5,duration:r,delay:t},{force:.5,duration:r,delay:0},{force:.5,duration:r,delay:0},{force:.5,duration:r,delay:0},{force:1,duration:r,delay:t},{force:1,duration:r,delay:250},{force:1,duration:r,delay:t}]);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function D(){return A.apply(this,arguments)}function A(){return(A=(0,a.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(g.PreferenceUtils.getSetting(v.Setting.MUSIC_ENABLED)){e.next=2;break}return e.abrupt("return");case 2:if(this.isThemePlaying)return e.abrupt("return");e.next=4;break;case 4:this.isThemePlaying=!0,p.AudioUtils.play({audio:d.SoundEffect.THEME,loop:!0,volume:.05});case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}r.GameStateMenu=e},{"../constants":21,"../enum/setting":26,"../enum/sound-effect":27,"../main":36,"../util/audio":55,"../util/image":57,"../util/input":58,"../util/locale":59,"../util/preference":61,"../util/text":63,"./../enum/game-state-type":23,"./game-state":51,"@babel/runtime/helpers/assertThisInitialized":1,"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/getPrototypeOf":12,"@babel/runtime/helpers/inherits":13,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/helpers/possibleConstructorReturn":15,"@babel/runtime/regenerator":20}],48:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.GameStateOver=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),o=n(e("@babel/runtime/helpers/inherits")),l=n(e("@babel/runtime/helpers/possibleConstructorReturn")),s=n(e("@babel/runtime/helpers/getPrototypeOf")),u=(e("../constants"),e("../enum/game-state-type")),c=e("../util/input"),h=e("../util/locale"),f=e("../util/text");e("./../main");function p(e,t){var r,n,i,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(o=function(e,t){var r;if(e)return"string"==typeof e?d(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,s.default)(r);return e=n?(e=(0,s.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,e)}}n=function(e){(0,o.default)(n,e);var r=b(n);function n(e){var t;return(0,i.default)(this,n),(t=r.call(this)).game=e,t}return(0,a.default)(n,[{key:"update",value:function(e){c.InputUtils.isAnyKeyDown()&&(this.game.reset(),this.game.statePlaying.reset(),this.game.state=u.GameStateType.PLAYING)}},{key:"preRender",value:function(e){e.save(),e.filter="blur(2px)"}},{key:"render",value:function(e){this.game.board.render(e);var t,r=p(this.game.uiPanels);try{for(r.s();!(t=r.n()).done;)t.value.render(e)}catch(e){r.e(e)}finally{r.f()}this.game.particleController.render(e),e.fillStyle="rgba(0, 0, 0, 0.35)",e.fillRect(0,0,this.game.board.width,this.game.board.height),e.restore(),f.TextUtils.drawCRT({ctx:e,text:h.LocaleUtils.get("gameover"),x:this.game.board.width/2,y:this.game.board.height/2-25,fontFamily:"Nintendoid1",fontSize:30.5*window.fontScale,color:"#fefefe"}),f.TextUtils.drawCRT({ctx:e,text:h.LocaleUtils.get("press_any_key_to_restart"),x:this.game.board.width/2,y:this.game.board.height/2+10,fontFamily:"Nintendoid1",fontSize:8*window.fontScale,color:"#fefefe"})}}]),n}(e("./game-state").GameState);r.GameStateOver=n},{"../constants":21,"../enum/game-state-type":23,"../util/input":58,"../util/locale":59,"../util/text":63,"./../main":36,"./game-state":51,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/getPrototypeOf":12,"@babel/runtime/helpers/inherits":13,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/helpers/possibleConstructorReturn":15}],49:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.GameStatePause=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),o=n(e("@babel/runtime/helpers/inherits")),l=n(e("@babel/runtime/helpers/possibleConstructorReturn")),s=n(e("@babel/runtime/helpers/getPrototypeOf")),u=e("../enum/game-state-type"),c=(e("../main"),e("../util/input")),h=e("../util/locale"),f=e("../util/text");function p(e,t){var r,n,i,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(o=function(e,t){var r;if(e)return"string"==typeof e?d(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,s.default)(r);return e=n?(e=(0,s.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,e)}}n=function(e){(0,o.default)(n,e);var r=b(n);function n(e){var t;return(0,i.default)(this,n),(t=r.call(this)).game=e,t}return(0,a.default)(n,[{key:"update",value:function(e){c.InputUtils.isAnyKeyDown()&&(this.game.state=u.GameStateType.PLAYING,c.InputUtils.resetAllKeys())}},{key:"preRender",value:function(e){e.save(),e.filter="blur(2px)"}},{key:"render",value:function(e){this.game.board.render(e),this.game.statePlaying.ghostPiece.render(e,this.game.board.cellSize),this.game.statePlaying.fallingPiece.render(e,this.game.board.cellSize);var t,r=p(this.game.uiPanels);try{for(r.s();!(t=r.n()).done;)t.value.render(e)}catch(e){r.e(e)}finally{r.f()}this.game.particleController.render(e),e.fillStyle="rgba(0, 0, 0, 0.35)",e.fillRect(0,0,this.game.board.width,this.game.board.height),e.restore(),f.TextUtils.drawCRT({ctx:e,text:h.LocaleUtils.get("paused"),x:this.game.board.width/2,y:this.game.board.height/2-25,fontFamily:"Nintendoid1",fontSize:30.5*window.fontScale,color:"#fefefe"}),f.TextUtils.drawCRT({ctx:e,text:h.LocaleUtils.get("press_any_key_to_resume"),x:this.game.board.width/2,y:this.game.board.height/2+10,fontFamily:"Nintendoid1",fontSize:8*window.fontScale,color:"#fefefe"})}}]),n}(e("./game-state").GameState);r.GameStatePause=n},{"../enum/game-state-type":23,"../main":36,"../util/input":58,"../util/locale":59,"../util/text":63,"./game-state":51,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/getPrototypeOf":12,"@babel/runtime/helpers/inherits":13,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/helpers/possibleConstructorReturn":15}],50:[function(e,G,t){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(t,"__esModule",{value:!0}),t.GameStatePlaying=void 0,r(e("@babel/runtime/helpers/classCallCheck"))),a=r(e("@babel/runtime/helpers/createClass")),o=r(e("@babel/runtime/helpers/assertThisInitialized")),l=r(e("@babel/runtime/helpers/inherits")),s=r(e("@babel/runtime/helpers/possibleConstructorReturn")),u=r(e("@babel/runtime/helpers/getPrototypeOf")),n=e("../model/ghost-piece"),c=e("../model/falling-piece"),h=e("../util/random-bag"),r=e("./game-state"),f=e("../util/audio"),p=e("../enum/sound-effect"),d=e("../particle/combo-particle"),b=(e("../main"),e("../enum/game-state-type")),m=e("../model/level"),y=e("../util/input"),v=e("../enum/key"),g=e("../particle/explosion-particle"),w=(e("../model/cell"),e("../util/preference")),C=e("../enum/setting"),U=e("../model/tetromino");function x(e,t){var r,n,i,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(o=function(e,t){var r;if(e)return"string"==typeof e?P(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?P(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function j(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,u.default)(r);return e=n?(e=(0,u.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,s.default)(this,e)}}function R(e,t){var r=e;if(t.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object");t.add(e)}function S(e,t,r){if(t.has(e))return r;throw new TypeError("attempted to get private field on non-instance")}var E=new WeakSet,k=new WeakSet,T=new WeakSet,_=new WeakSet,O=new WeakSet,D=new WeakSet,A=new WeakSet,L=new WeakSet,e=function(e){(0,l.default)(n,e);var r=j(n);function n(e){var t;return(0,i.default)(this,n),t=r.call(this),R((0,o.default)(t),L),R((0,o.default)(t),A),R((0,o.default)(t),D),R((0,o.default)(t),O),R((0,o.default)(t),_),R((0,o.default)(t),T),R((0,o.default)(t),k),R((0,o.default)(t),E),t.game=e,t.fallingPiece=null,t.ghostPiece=null,t.stats={score:0,linesCleared:0,comboCounter:0,piecesPlaced:0},t}return(0,a.default)(n,[{key:"reset",value:function(){h.RandomBag.reset(),S(this,E,I).call(this),this.stats={score:0,linesCleared:0,comboCounter:0,piecesPlaced:0},S(this,O,M).call(this)}},{key:"update",value:function(e){if(y.InputUtils.isKeyDown(v.Key.ESCAPE))S(this,A,K).call(this);else{y.InputUtils.isKeyDown(v.Key.CONTROL)&&(S(this,L,q).call(this),y.InputUtils.resetKey(v.Key.CONTROL)),this.fallingPiece.update(e),this.game.board.isAnyCellBellowShape(this.fallingPiece)||this.fallingPiece.y+this.fallingPiece.height>=this.game.board.rows?S(this,T,B).call(this):this.ghostPiece.update(),y.InputUtils.resetKey(v.Key.ARROW_UP),y.InputUtils.resetKey(v.Key.ENTER),this.game.particleController.update(e);var t,r=x(this.game.uiPanels);try{for(r.s();!(t=r.n()).done;)t.value.update(e)}catch(e){r.e(e)}finally{r.f()}}}},{key:"render",value:function(e){this.game.board.render(e);var t,r=x(this.game.uiPanels);try{for(r.s();!(t=r.n()).done;)t.value.render(e)}catch(e){r.e(e)}finally{r.f()}this.game.particleController.render(e),this.ghostPiece.render(e,this.game.board.cellSize),this.fallingPiece.render(e,this.game.board.cellSize)}}]),n}(r.GameState);function I(){var e=h.RandomBag.pop();this.fallingPiece=new c.FallingPiece(this.game,e),this.ghostPiece=new n.GhostPiece(this.fallingPiece)}function N(e){var t;this.game.board.isAnyCellBellowShape(this.fallingPiece)?S(this,_,z).call(this):0<(t=this.game.board.removeFilledRows())?(0<this.stats.comboCounter&&this.game.particleController.add(new d.ComboParticle({x:e.x,y:e.y-20,game:this.game})),S(this,D,F).call(this,t)):this.stats.comboCounter=0}function B(){w.PreferenceUtils.getSetting(C.Setting.SOUND_EFFECTS_ENABLED)&&f.AudioUtils.play({audio:p.SoundEffect.PLACE_BLOCK,pitch:Math.randomRange(.75,1.25)});var e={x:Math.max((this.fallingPiece.x+this.fallingPiece.width/2)*this.game.board.cellSize,0),y:this.fallingPiece.y*this.game.board.cellSize};w.PreferenceUtils.getSetting(C.Setting.FALL_PARTICLES_ENABLED)&&(y.InputUtils.isKeyDown(v.Key.ARROW_DOWN)||y.InputUtils.isKeyDown(v.Key.SPACE))&&g.ExplosionParticle.create(this.game.particleController,this.game.board.cellSize,this.fallingPiece),y.InputUtils.resetAllKeys(),this.game.board.place(this.fallingPiece),S(this,E,I).call(this),this.stats.score+=this.game.currentLevelIndex+1,this.stats.piecesPlaced++,S(this,k,N).call(this,e)}function z(){f.AudioUtils.play({audio:p.SoundEffect.GAME_OVER}),this.game.state=b.GameStateType.GAMEOVER,y.InputUtils.rumbleSequence([{force:1,duration:250,delay:0},{force:.5,duration:150,delay:150}]),y.InputUtils.resetAllKeys()}function M(){this.game.currentLevel.applyPageColors(),this.game.board.setColorForAllCells("#d0d0d0","#aaa")}function F(e){this.stats.linesCleared+=e,this.stats.linesCleared%10==0&&(this.game.currentLevelIndex=Math.clamp(this.game.currentLevelIndex+1,0,m.Level.list.length-1),S(this,O,M).call(this),y.InputUtils.rumble(1,200));var t=this.game.currentLevelIndex+1,r=100*this.stats.comboCounter*t,t=100*Math.pow(e,2)*t+r;this.stats.score+=t,this.stats.comboCounter++,w.PreferenceUtils.getSetting(C.Setting.SOUND_EFFECTS_ENABLED)&&(r=.75+.25*Math.min(e/3,1),f.AudioUtils.play({audio:p.SoundEffect.SCORE,pitch:r}))}function K(){this.game.state=b.GameStateType.PAUSED,y.InputUtils.resetAllKeys()}function q(){var t=this,e=U.Tetrominoes.find(function(e){return e.type==t.fallingPiece.type}),r=h.RandomBag.pop();this.fallingPiece.type=r.type,this.fallingPiece.shape=r.shape,this.ghostPiece.calculateColor(),this.ghostPiece.drawPosition.x=this.fallingPiece.x+1,h.RandomBag.push(e)}t.GameStatePlaying=e},{"../enum/game-state-type":23,"../enum/key":25,"../enum/setting":26,"../enum/sound-effect":27,"../main":36,"../model/cell":38,"../model/falling-piece":39,"../model/ghost-piece":40,"../model/level":41,"../model/tetromino":43,"../particle/combo-particle":44,"../particle/explosion-particle":45,"../util/audio":55,"../util/input":58,"../util/preference":61,"../util/random-bag":62,"./game-state":51,"@babel/runtime/helpers/assertThisInitialized":1,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/getPrototypeOf":12,"@babel/runtime/helpers/inherits":13,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/helpers/possibleConstructorReturn":15}],51:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.GameState=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass"));r.GameState=function(){function e(){(0,i.default)(this,e)}return(0,a.default)(e,[{key:"update",value:function(e){}},{key:"preRender",value:function(e){}},{key:"render",value:function(e){}}]),e}()},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],52:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.UIBag=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),o=n(e("@babel/runtime/helpers/inherits")),l=n(e("@babel/runtime/helpers/possibleConstructorReturn")),s=n(e("@babel/runtime/helpers/getPrototypeOf")),u=e("../constants"),c=(e("../main"),e("../model/piece")),h=e("../util/locale"),f=e("../util/random-bag"),p=e("../util/text"),d=e("../widget/density-canvas");function b(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,s.default)(r);return e=n?(e=(0,s.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,e)}}n=function(e){(0,o.default)(n,e);var r=b(n);function n(e){var t;return(0,i.default)(this,n),(t=r.call(this)).lastPiece=null,t.buffer=new d.DensityCanvas,t.game=e,t}return(0,a.default)(n,[{key:"calculateSize",value:function(e){var t=e.width;e.height;this.position={x:t+this.padding,y:5*this.game.board.cellSize+this.padding},this.size={width:4*this.game.board.cellSize,height:4*this.game.board.cellSize},this.buffer.setSize({width:this.size.width,height:this.size.height-70})}},{key:"update",value:function(e){var t,r,n,i=f.RandomBag.peek();this.lastPiece!=i&&(t=this.buffer.context,r=.75*this.game.board.cellSize,this.buffer.clear(),(n=new c.Piece).shape=i.shape,n.height=n.shape.length,n.width=n.shape[0].length,n.drawPosition={x:(this.size.width/2-n.width*r/2)/r,y:(this.buffer.height/2-n.height*r/2)/r},n.color=this.game.currentLevel.getColorForPiece(i.type),n.render(t,r))}},{key:"render",value:function(e){e.fillStyle=u.UI_PANEL_BACKGROUND,e.strokeStyle=u.EMPTY_CELL_BORDER,e.lineWidth=1,e.save(),e.translate(this.position.x,this.position.y),e.beginPath(),e.roundRect(0,0,this.size.width,this.size.height,[u.CELL_RADIUS]),e.fill(),e.stroke(),p.TextUtils.drawCRT({ctx:e,text:h.LocaleUtils.get("next"),x:this.size.width/2,y:40,fontFamily:"Nintendoid1",fontSize:15.5*window.fontScale,color:"#fefefe"}),this.buffer.drawBufferTo(0,this.bufferPadding,e),e.restore()}},{key:"bufferPadding",get:function(){return 120}},{key:"padding",get:function(){return 20}}]),n}(e("./ui-panel").UIPanel);r.UIBag=n},{"../constants":21,"../main":36,"../model/piece":42,"../util/locale":59,"../util/random-bag":62,"../util/text":63,"../widget/density-canvas":64,"./ui-panel":53,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/getPrototypeOf":12,"@babel/runtime/helpers/inherits":13,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/helpers/possibleConstructorReturn":15}],53:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.UIPanel=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass"));r.UIPanel=function(){function e(){(0,i.default)(this,e)}return(0,a.default)(e,[{key:"calculateSize",value:function(e){e.width,e.height}},{key:"update",value:function(e){}},{key:"render",value:function(e){}}]),e}()},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],54:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.UIStats=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),o=n(e("@babel/runtime/helpers/inherits")),l=n(e("@babel/runtime/helpers/possibleConstructorReturn")),s=n(e("@babel/runtime/helpers/getPrototypeOf")),u=e("../constants"),c=(e("../main"),e("../util/locale")),h=e("../util/text");function f(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,s.default)(r);return e=n?(e=(0,s.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,l.default)(this,e)}}n=function(e){(0,o.default)(n,e);var r=f(n);function n(e){var t;return(0,i.default)(this,n),(t=r.call(this)).game=e,t}return(0,a.default)(n,[{key:"calculateSize",value:function(e){var t=e.width;e.height;this.position={x:t+this.padding,y:0},this.size={width:4*this.game.board.cellSize,height:5*this.game.board.cellSize}}},{key:"update",value:function(e){}},{key:"render",value:function(e){e.fillStyle=u.UI_PANEL_BACKGROUND,e.strokeStyle=u.EMPTY_CELL_BORDER,e.lineWidth=1,e.save(),e.translate(this.position.x,this.position.y),e.beginPath(),e.roundRect(0,0,this.size.width,this.size.height,[u.CELL_RADIUS]),e.fill(),e.stroke(),h.TextUtils.drawCRT({ctx:e,text:c.LocaleUtils.get("tetris"),x:this.size.width/2,y:40*window.fontScale,fontFamily:"Nintendoid1",fontSize:15.5*window.fontScale,color:"#fefefe"}),e.fillStyle="#fefefe",e.font="".concat(8*window.fontScale,"pt Nintendoid1"),e.fillText(c.LocaleUtils.get("score"),12.5*window.fontScale,70*window.fontScale,this.size.width),e.fillText(this.game.statePlaying.stats.score,12.5*window.fontScale,90*window.fontScale,this.size.width),e.fillText(c.LocaleUtils.get("lines"),12.5*window.fontScale,115*window.fontScale,this.size.width),e.fillText(this.game.statePlaying.stats.linesCleared,12.5*window.fontScale,135*window.fontScale,this.size.width),e.fillText(c.LocaleUtils.get("pieces"),12.5*window.fontScale,160*window.fontScale,this.size.width),e.fillText(this.game.statePlaying.stats.piecesPlaced,12.5*window.fontScale,180*window.fontScale,this.size.width),e.restore()}},{key:"padding",get:function(){return 20}}]),n}(e("./ui-panel").UIPanel);r.UIStats=n},{"../constants":21,"../main":36,"../util/locale":59,"../util/text":63,"./ui-panel":53,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/getPrototypeOf":12,"@babel/runtime/helpers/inherits":13,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/helpers/possibleConstructorReturn":15}],55:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),p=(Object.defineProperty(r,"__esModule",{value:!0}),r.AudioUtils=void 0,n(e("@babel/runtime/regenerator"))),i=n(e("@babel/runtime/helpers/asyncToGenerator")),a=n(e("@babel/runtime/helpers/classCallCheck")),o=n(e("@babel/runtime/helpers/createClass"));e("../enum/sound-effect");function d(e,t,r){if(e!==t)throw new TypeError("Private static access of wrong provenance");return r}n=function(){function f(){(0,a.default)(this,f)}var t;return(0,o.default)(f,null,[{key:"play",value:(t=(0,i.default)(p.default.mark(function e(t){var r,n,i,a,o,l,s,u,c,h;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return h=t.audio,r=t.pitch,r=void 0===r?1:r,n=t.volume,n=void 0===n?1:n,i=t.loop,i=void 0!==i&&i,a=t.cache,a=void 0===a||a,o=t.onStart,o=void 0===o?null:o,l=t.onEnd,l=void 0===l?null:l,s=d(this,f,m).call(this),u=s.createBufferSource(),(c=d(this,f,y).call(this,s)).connect(s.destination),h=d(this,f,b).call(this,h),e.next=8,d(this,f,v).call(this,h,a);case 8:return h=e.sent,e.next=11,s.decodeAudioData(h);case 11:u.buffer=e.sent,u.playbackRate.value=r,u.connect(c),c.gain.value=n,u.loop=i,u.play=u.start,u.play(),o&&setTimeout(o,0),l&&u.addEventListener("ended",l.bind(this));case 20:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})}]),f}();function b(e){return(window.location.href.indexOf("http://localhost:")?window.location.href:window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")))+"/assets/audio/"+e}function m(){return new(window.AudioContext||window.webkitAudioContext)}function y(e){return"createGain"in e?e.createGain():e.createGainNode()}function v(e){return l.apply(this,arguments)}function l(){return(l=(0,i.default)(p.default.mark(function e(t){var r;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,fetch(t);case 3:return r=e.sent,e.next=6,r.arrayBuffer();case 6:return r=e.sent,e.abrupt("return",r);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}r.AudioUtils=n},{"../enum/sound-effect":27,"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/regenerator":20}],56:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.ColorUtils=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass"));function l(e,t,r){if(e!==t)throw new TypeError("Private static access of wrong provenance");return r}var o=function(){function o(){(0,i.default)(this,o)}return(0,a.default)(o,null,[{key:"blend",value:function(t,e,r){var n=this,i=l(this,o,u).call(this,e),a=l(this,o,u).call(this,r),e=[0,1,2].map(function(e){return l(n,o,c).call(n,i[e],a[e],t)});return"rgb(".concat(e[0],",").concat(e[1],",").concat(e[2],")")}}]),o}();function s(e,t){var r;return e.length<=5?(r=e.substr(1+t,1),"".concat(r).concat(r)):e.substr(1+2*t,2)}function u(t){var r=this;return"string"==typeof t&&t.startsWith("rgb")?t.substring(t.indexOf("(")+1,t.length-1).split(",").map(parseFloat):"string"==typeof t&&"#"===t[0]?[0,1,2].map(function(e){return parseInt(l(r,o,s).call(r,t,e),16)}):t}function c(e,t,r){return parseInt(e*(1-r)+t*r,10)}r.ColorUtils=o,window.ColorUtils=o,window.ColorUtils=o},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],57:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.ImageUtils=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),o=n(e("@babel/runtime/helpers/createClass"));function l(e,t,r){if(e!==t)throw new TypeError("Private static access of wrong provenance");t="get";if(void 0===r)throw new TypeError("attempted to "+t+" private static field before its declaration");t=e,e=r;return e.get?e.get.call(t):e.value}r.ImageUtils=function(){function a(){(0,i.default)(this,a)}return(0,o.default)(a,null,[{key:"load",value:function(n){var i=this;return new Promise(function(e,t){if(l(i,a,s).hasOwnProperty(n))return e(l(i,a,s)[n]);var r=new Image;r.onload=function(){l(i,a,s)[n]=r,e(r)},r.onerror=function(e){t(e)},r.src="assets/images/".concat(n)})}}]),a}();var s={writable:!0,value:{}}},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],58:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),c=(Object.defineProperty(r,"__esModule",{value:!0}),r.InputUtils=void 0,n(e("@babel/runtime/regenerator"))),i=n(e("@babel/runtime/helpers/asyncToGenerator")),a=n(e("@babel/runtime/helpers/classCallCheck")),o=n(e("@babel/runtime/helpers/createClass")),l=e("../constants"),s=e("../enum/game-state-type"),u=e("../enum/gamepad-key"),n=e("../enum/key");function h(e,t){var r,n,i,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(o=function(e,t){var r;if(e)return"string"==typeof e?f(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t,r,n){y(e,t),b(r,"set");t=e,e=r,r=n;if(e.set)e.set.call(t,r);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=r}}function d(e,t,r){y(e,t),b(r,"get");t=e,e=r;return e.get?e.get.call(t):e.value}function b(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function m(e,t,r){return y(e,t),r}function y(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}var v=function(){function u(){(0,a.default)(this,u)}var t,e;return(0,o.default)(u,null,[{key:"attachListeners",value:function(){window.addEventListener("keyup",m(this,u,x).bind(this)),window.addEventListener("keydown",m(this,u,x).bind(this)),window.addEventListener("gamepadconnected",m(this,u,g).bind(this)),window.addEventListener("gamepaddisconnected",m(this,u,w).bind(this))}},{key:"update",value:function(){d(this,u,T).clear(),m(this,u,C).call(this)}},{key:"rumble",value:(e=(0,i.default)(c.default.mark(function e(){var t,r,n,i,a,o,l=this,s=arguments;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0<s.length&&void 0!==s[0]?s[0]:1,r=1<s.length&&void 0!==s[1]?s[1]:50,d(this,u,R)){e.next=4;break}return e.abrupt("return");case 4:if(n=navigator.getGamepads().find(function(e){return e&&e.id==d(l,u,R)})){e.next=7;break}return e.abrupt("return");case 7:i=[],n.vibrationActuator?i=[n.vibrationActuator]:n.hapticActuators&&(i=n.hapticActuators.filter(function(e){return e})),i=h(i),e.prev=10,i.s();case 12:if((a=i.n()).done)e.next=24;else{if((o=a.value).pulse)return e.next=17,o.pulse(t,r);e.next=19}break;case 17:e.next=22;break;case 19:if(o.playEffect)return e.next=22,o.playEffect(o.type||"dual-rumble",{startDelay:0,duration:r,weakMagnitude:t/2,strongMagnitude:t});e.next=22;break;case 22:e.next=12;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(10),i.e(e.t0);case 29:return e.prev=29,i.f(),e.finish(29);case 32:case"end":return e.stop()}},e,this,[[10,26,29,32]])})),function(){return e.apply(this,arguments)})},{key:"rumbleSequence",value:(t=(0,i.default)(c.default.mark(function e(t){var r,n,i;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d(this,u,R)){e.next=2;break}return e.abrupt("return");case 2:r=function(r){return new Promise(function(e,t){setTimeout(e,r)})},n=h(t),e.prev=4,n.s();case 6:if((i=n.n()).done){e.next=15;break}return i=i.value,e.next=10,r(i.delay);case 10:return this.rumble(i.force,i.duration),e.next=13,r(i.duration);case 13:e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:case"end":return e.stop()}},e,this,[[4,17,20,23]])})),function(e){return t.apply(this,arguments)})},{key:"isKeyDown",value:function(e){return-1!==d(this,u,E).indexOf(e)}},{key:"isKeyDownOneshot",value:function(e){return d(this,u,T).includes(e)}},{key:"isAnyKeyDown",value:function(){return 0<d(this,u,E).length}},{key:"resetKey",value:function(e){e=d(this,u,E).indexOf(e);-1!==e&&d(this,u,E).splice(e,1)}},{key:"resetAllKeys",value:function(){p(this,u,T,[]),p(this,u,E,[])}}]),u}();function g(e){console.log("Gamepad connected with id ".concat(e.gamepad.index)),d(this,v,R)?console.log("Ignoring due to already connected gamepad!"):p(this,v,R,e.gamepad.id)}function w(e){console.log("Gamepad disconnected with id ".concat(e.gamepad.index)),d(this,v,R)===e.gamepad.id&&(console.log("Current connected gamepad has been disconnected!"),p(this,v,R,null),window.main.state=s.GameStateType.PAUSED)}function C(){var t=this;if(d(this,v,R)){var e,r=navigator.getGamepads().find(function(e){return e&&e.id==d(t,v,R)});if(r)for(var n in u.GamepadKey)u.GamepadKey.hasOwnProperty(n)&&(n=u.GamepadKey[n],e=r.buttons[n].pressed,n=u.GamepadKeyToKeyboardKey[n],m(this,v,P).call(this,n,e))}}function x(e){m(this,v,P).call(this,e.code,"keydown"===e.type)}function P(t,e){var r=d(this,v,k).find(function(e){return e.key===t});if(r){if(r.isPressed===e)return;r.isPressed=e,r.isPressed?(r.start=performance.now(),delete r.end):(r.end=performance.now(),r.end-r.start<=l.ONESHOT_BUTTON_TRIGGER_THRESHOLD&&d(this,v,T).push(t))}else d(this,v,k).push({key:t,isPressed:e,start:performance.now()});-1!==d(this,v,S).indexOf(t)&&(r=d(this,v,E).indexOf(t),e?-1===r&&d(this,v,E).push(t):-1!==r&&d(this,v,E).splice(r,1))}r.InputUtils=v;var R={writable:!0,value:null},S={writable:!0,value:Object.values(n.Key)},E={writable:!0,value:[]},k={writable:!0,value:[]},T={writable:!0,value:[]};v.attachListeners()},{"../constants":21,"../enum/game-state-type":23,"../enum/gamepad-key":24,"../enum/key":25,"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/regenerator":20}],59:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.LocaleUtils=void 0,n(e("@babel/runtime/regenerator"))),a=n(e("@babel/runtime/helpers/asyncToGenerator")),o=n(e("@babel/runtime/helpers/classCallCheck")),l=n(e("@babel/runtime/helpers/createClass"));function s(e,t,r){return f(e,t),r}function u(e,t,r){f(e,t),h(r,"get");t=e,e=r;return e.get?e.get.call(t):e.value}function c(e,t,r,n){f(e,t),h(r,"set");t=e,e=r,r=n;if(e.set)e.set.call(t,r);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=r}}function h(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function f(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}var p=function(){function t(){(0,o.default)(this,t)}var e;return(0,l.default)(t,null,[{key:"initialize",value:(e=(0,a.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(this,t,d).call(this);case 2:return e.next=4,s(this,t,m).call(this);case 4:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"get",value:function(e){return u(this,t,g).hasOwnProperty(e)?u(this,t,g)[e]:(console.error("Could not load entry ".concat(e," at ").concat(u(this,t,v),".json!")),"")}}]),t}();function d(){return b.apply(this,arguments)}function b(){return(b=(0,a.default)(i.default.mark(function e(){var t,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=["en","pt"],r=navigator.languages.map(function(e){return e.split("-").find(function(e){return e})}),r=r.find(function(e){return t.includes(e)}),c(this,p,v,r||t.find(function(e){return e}));case 4:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,a.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("assets/locale/".concat(u(this,p,v),".json"));case 2:return t=e.sent,e.next=5,t.json();case 5:t=e.sent,c(this,p,g,t);case 7:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}r.LocaleUtils=p;var v={writable:!0,value:"en"},g={writable:!0,value:null}},{"@babel/runtime/helpers/asyncToGenerator":2,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14,"@babel/runtime/regenerator":20}],60:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.MouseUtils=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),n=n(e("@babel/runtime/helpers/defineProperty"));function o(e,t,r){if(e!==t)throw new TypeError("Private static access of wrong provenance");return r}e=function(){function t(){(0,i.default)(this,t)}return(0,a.default)(t,null,[{key:"attachHooks",value:function(e){e.addEventListener("mousedown",o(this,t,l).bind(this)),e.addEventListener("mouseup",o(this,t,s).bind(this)),e.addEventListener("mousemove",o(this,t,u).bind(this))}}]),t}();function l(e){this.position.x=e.clientX,this.position.y=e.clientY,this.isPressed=!0}function s(e){this.position.x=e.clientX,this.position.y=e.clientY,this.isPressed=!1}function u(e){this.position.x=e.clientX,this.position.y=e.clientY}r.MouseUtils=e,(0,n.default)(e,"position",{x:0,y:0}),(0,n.default)(e,"isPressed",!1)},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/defineProperty":10,"@babel/runtime/helpers/interopRequireDefault":14}],61:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.PreferenceUtils=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass"));e("./../enum/setting");r.PreferenceUtils=function(){function e(){(0,i.default)(this,e)}return(0,a.default)(e,null,[{key:"getSetting",value:function(e){return!0===this.get(e,!0,!0)}},{key:"setSetting",value:function(e,t){this.set(e,t)}},{key:"get",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],e=(e=localStorage.getItem(e))||t;return e=r?JSON.parse(e):e}},{key:"set",value:function(e,t){return(!(2<arguments.length&&void 0!==arguments[2])||arguments[2])&&(t=JSON.stringify(t)),localStorage.setItem(e,t)}}]),e}()},{"./../enum/setting":26,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],62:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.RandomBag=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),o=e("../model/tetromino");function l(e,t,r,n){c(e,t),u(r,"set");t=e,e=r,r=n;if(e.set)e.set.call(t,r);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=r}}function s(e,t,r){c(e,t),u(r,"get");t=e,e=r;return e.get?e.get.call(t):e.value}function u(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function c(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}r.RandomBag=function(){function t(){(0,i.default)(this,t)}return(0,a.default)(t,null,[{key:"push",value:function(e){s(this,t,h).push(e)}},{key:"peek",value:function(){return s(this,t,h).length<=0&&this.reset(),s(this,t,h)[s(this,t,h).length-1]}},{key:"pop",value:function(){return s(this,t,h).length<=0&&this.reset(),s(this,t,h).pop()}},{key:"reset",value:function(){l(this,t,h,o.Tetrominoes.slice(0).shuffle())}}]),t}();var h={writable:!0,value:[]}},{"../model/tetromino":43,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],63:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.TextUtils=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass"));function c(e,t,r){l(e,t),o(r,"get");t=e,e=r;return e.get?e.get.call(t):e.value}function h(e,t,r,n){l(e,t),o(r,"set");t=e,e=r,r=n;if(e.set)e.set.call(t,r);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=r}}function o(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function l(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}r.TextUtils=function(){function u(){(0,i.default)(this,u)}return(0,a.default)(u,null,[{key:"drawCRT",value:function(e){function t(){return Math.random()-.5}var r=e.ctx,n=e.text,i=e.x,a=e.y,o=e.color,o=void 0===o?"#fff":o,l=e.fontFamily,l=void 0===l?null:l,s=e.fontSize,e=e.centered,e=void 0===e||e;r.font="".concat(void 0===s?12:s,"pt ").concat(l),h(this,u,f,Math.clamp(c(this,u,f)+t(),-2,2)),h(this,u,p,Math.clamp(c(this,u,p)+t(),-2,2)),r.save(),Math.random()<=.5&&(r.filter="blur(3px)"),r.fillStyle="#ea36afF0",e?r.fillTextCentered(n,i+c(this,u,f),a+c(this,u,p)):r.fillText(n,i+c(this,u,f),a+c(this,u,p)),r.fillStyle="#75fa69F0",e?r.fillTextCentered(n,i+-1*c(this,u,f),a+-1*c(this,u,p)):r.fillText(n,i+-1*c(this,u,f),a+-1*c(this,u,p)),r.restore(),r.fillStyle=o,e?r.fillTextCentered(n,i,a):r.fillText(n,i,a)}}]),u}();var f={writable:!0,value:0},p={writable:!0,value:0}},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}],64:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.DensityCanvas=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass"));function o(e,t){var r=e;if(t.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object");t.add(e)}function l(e,t,r){if(t.has(e))return r;throw new TypeError("attempted to get private field on non-instance")}var s=new WeakSet,u=new WeakSet,c=new WeakSet;function h(e){return this.enableHighDPI&&(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio)||1}function f(){return this.enableHighDPI&&window.devicePixelRatio||1}function p(e,t){return t/e}r.DensityCanvas=function(){function e(){(0,i.default)(this,e),o(this,c),o(this,u),o(this,s),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.virtualWidth=null,this.virtualHeight=null,this.enableHighDPI=!0}return(0,a.default)(e,[{key:"setSize",value:function(e){var t=e.width,e=e.height,r=l(this,s,h).call(this,this.context),n=l(this,u,f).call(this);this.drawRatio=l(this,c,p).call(this,r,n),r!==n?(this.canvas.width=t*this.drawRatio,this.canvas.height=e*this.drawRatio,this.canvas.style.width="".concat(t,"px"),this.canvas.style.minWidth="".concat(t,"px"),this.canvas.style.height="".concat(e,"px"),this.canvas.style.minHeight="".concat(e,"px")):(this.canvas.width=t,this.canvas.height=e,this.canvas.style.width="",this.canvas.style.height=""),this.context.scale(this.drawRatio,this.drawRatio),this.virtualWidth=t,this.virtualHeight=e}},{key:"clear",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"drawBufferTo",value:function(e,t,r){r.save(),r.scale(1/this.drawRatio,1/this.drawRatio),r.drawImage(this.canvas,e,t),r.restore()}},{key:"attachToElement",value:function(e){e.appendChild(this.canvas)}},{key:"width",get:function(){return this.virtualWidth||this.canvas.width}},{key:"height",get:function(){return this.virtualHeight||this.canvas.height}}]),e}()},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":9,"@babel/runtime/helpers/interopRequireDefault":14}]},{},[36]);
//# sourceMappingURL=script.min.js.map
